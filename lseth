#!/bin/bash
#
# $Id: lseth,v 1.2 2014/12/10 21:05:10 root Exp $
#

for mydev in $(ls -d /sys/class/net/eth* 2> /dev/null|xargs -n1|sort -V)
do
	if [ "x${mydev}" != "x" ]; then
		HWPATH="${mydev}/device"
		DEVI=$(basename ${mydev})
		if [ -d ${HWPATH} ]; then
			# SWDRIVER=$(ls -ld ${HWPATH}/driver|sed -e 's@^.*/@@' )
			# HWPATH=$(ls -ld ${HWPATH} |sed -e 's@^.*/@@' )
			SWDRIVER=$(/sbin/ethtool -i ${DEVI}|awk '{ if ( $1 == "driver:" ) { print $2}}' )
			HWPATH=$(/sbin/ethtool -i ${DEVI}|awk '{ if ( $1 == "bus-info:" ) { print $2}}' )
		fi
		MCADDR=$(/sbin/ip a l ${DEVI}|awk '{ if ( $1 ~ /link.ether/ ) print $2 }')

		case ${SWDRIVER} in
			# For these drivers, there is much info in the Subsystem field..
			ixgbe|sfc|e1000e)
				DESC=$(/sbin/lspci -mm -s ${HWPATH}|xargs -n1|tail -1 )
				;;
			*)
				DESC=$(/sbin/lspci -D -s ${HWPATH}|sed -e 's@.* controller: @@' )
				;;
		esac
		echo -e "${DEVI} ${SWDRIVER}\t${HWPATH}\t${MCADDR}\t${DESC}"
	fi
done

for mydev in $(ls -d /sys/class/net/bond* 2> /dev/null |xargs -n1|sort -V)
do
	if [ "x${mydev}" != "x" ]; then
		HWPATH="${mydev}/bonding"
		DEVI=$(basename ${mydev})
		if [ -d ${HWPATH} ]; then
			STATE=$(cat ${mydev}/operstate)
			SLAVES=$(cat ${mydev}/bonding/slaves)
			echo -e "${DEVI}\t\t[ ${SLAVES} ]"
		fi
	fi
done

