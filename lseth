#!/bin/bash

for mydev in $(ls -d /sys/class/net/eth* 2> /dev/null|xargs -n1|sort -V)
do
	if [ "x${mydev}" != "x" ]; then
		HWPATH="${mydev}/device"
		DEVI=$(basename ${mydev})
		if [ -d ${HWPATH} ]; then
			SWDRIVER=$(readlink ${HWPATH}/driver/|sed -e 's@/sys.*drivers/@@' )
			HWPATH=$(readlink ${HWPATH}/ |sed -e 's@/sys.*/@@' )
		fi
		MCADDR=$(/sbin/ip a l ${DEVI}|awk '{ if ( $1 ~ /link.ether/ ) print $2 }')

		case ${SWDRIVER} in
			# For these drivers, there is much info in the Subsystem field..
			ixgbe|sfc)
				DESC=$(/sbin/lspci -mm -s ${HWPATH}|xargs -n1|tail -1 )
				;;
			*)
				DESC=$(/sbin/lspci -D -s ${HWPATH}|sed -e 's@.* controller: @@' )
				;;
		esac
		echo -e "${DEVI} ${SWDRIVER}\t${HWPATH}\t${MCADDR}\t${DESC}"
	fi
done

for mydev in $(ls -d /sys/class/net/bond* 2> /dev/null |xargs -n1|sort -V)
do
	if [ "x${mydev}" != "x" ]; then
		HWPATH="${mydev}/bonding"
		DEVI=$(basename ${mydev})
		if [ -d ${HWPATH} ]; then
			STATE=$(cat ${mydev}/operstate)
			SLAVES=$(cat ${mydev}/bonding/slaves)
			echo -e "${DEVI}\t\t[ ${SLAVES} ]"
		fi
	fi
done

