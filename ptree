#!/bin/bash
# $Id: ptree,v 1.5 2013/05/21 15:54:06 root Exp $

# ptree only supports one and exactly one PID so forget other args..

# Initialization
myPID=$1
myPPID=${myPID}
myTOP=${myPID}

#Sub-routines
CheckPID() {
	# ptree only supports one and exactly one PID so forget about other args..
	if [ "x$1" = "x" ]; then
		echo "no PID specified!"
		return 0
	fi

	# Verify PID's presence
	ps --no-heading -o pid ${myPID} > /dev/null 2>&1 || {
		echo "PID $myPID does not exist!"
		return 1
	}
	return 0
}

GetPPID() {
	CheckPID $1 || exit 127
	localPPID=`ps --no-heading -o ppid ${myPPID} 2> /dev/null|xargs`
	[ "x${localPPID}" != "x" ] && {
		return 0
	} || {
		return ${localPPID}
	}		
}
#

CheckPID ${myPID} || exit 127

if [ "x${myTOP}" != "x" ]; then
	# Walk up to Find Parent until myPPID=1
	while [ ${myTOP} -gt 1 ]; do
		myTOP=`ps --no-heading -o ppid ${myPPID}|xargs`
		if [ ${myTOP} -gt 1 ]; then
			myPPID=${myTOP}
		fi
		# echo "Found PPID: ${myPPID}"
	done
	exec /usr/bin/pstree -plaA ${myPPID}
else
	exec /usr/bin/pstree -plaA
fi
